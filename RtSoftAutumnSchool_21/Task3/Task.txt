Пример работы state mashine:
при помощи boost::sml или корутин

двигатель, кот можно включить. включить - выключить - не работает - ошибка.